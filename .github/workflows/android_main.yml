name: Main Checks

on:
  push:
    branches:
      - main
    paths-ignore:
      - '**.md'
      - '*/.creds/**'
      - docs/**
      - LICENSE
  release:
    types: [ published ]

jobs:
  quality:
    uses: kevalpatel2106/pocket-ci/.github/workflows/reuse_code_analysis.yml@main
    secrets:
      CACHE_VERSION: ${{secrets.CACHE_VERSION}}

  test:
    uses: kevalpatel2106/pocket-ci/.github/workflows/reuse_tests.yml@main
    needs: [ quality ]
    secrets:
      CACHE_VERSION: ${{secrets.CACHE_VERSION}}
      CODECOV_TOKEN: ${{secrets.CODECOV_TOKEN}}

  build:
    uses: kevalpatel2106/pocket-ci/.github/workflows/reuse_build.yml@main
    needs: [ test ]
    secrets:
      CACHE_VERSION: ${{secrets.CACHE_VERSION}}
      ANDROID_KEYSTORE_BASE64: ${{secrets.ANDROID_KEYSTORE_BASE64}}
      ANDROID_KEYSTORE_ALIAS: ${{secrets.ANDROID_KEYSTORE_ALIAS}}
      ANDROID_KEYSTORE_PASSWORD: ${{secrets.ANDROID_KEYSTORE_PASSWORD}}
      ANDROID_ALIAS_PASSWORD: ${{secrets.ANDROID_ALIAS_PASSWORD}}